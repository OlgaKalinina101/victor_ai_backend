# Victor AI - Personal AI Companion for Android
# Copyright (C) 2025-2026 Olga Kalinina

# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published
# by the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU Affero General Public License for more details.

def get_key_info_prompt(gender: str) -> str:
    """
    Генерирует промпт для извлечения ключевой информации с учетом пола пользователя.
    
    Args:
        gender: Пол пользователя ('девушка', 'мужчина', 'другое' из Gender enum)
    
    Returns:
        str: Промпт с правильными местоимениями
    """
    # Определяем местоимения и обращения в зависимости от пола
    if gender == "девушка":
        pronoun = "она"
        role = "цифровым партнером"
        verb_form = "работает, учится, ждет"
        example_subject = "Она"
    elif gender == "мужчина":
        pronoun = "он"
        role = "цифровым другом"
        verb_form = "работает, учится, ждет"
        example_subject = "Он"
    else:
        pronoun = "пользователь"
        role = "цифровым ассистентом"
        verb_form = "работает, учится, ждет"
        example_subject = "Пользователь"
    
    # Определяем окончания глаголов в зависимости от пола
    tired_form = "устал" if gender == "мужчина" else "устала" if gender == "девушка" else "устал(а)"
    happy_form = "счастливым" if gender == "мужчина" else "счастливой" if gender == "девушка" else "счастливым"
    got_job_form = "Устроился" if gender == "мужчина" else "Устроилась" if gender == "девушка" else "Устроился"
    
    return (
        "Проанализируй сообщение пользователя: {text}\n\n"
        "**Твоя задача:** Извлечь одно ключевое воспоминание или написать 'Нет ключевой информации'.\n\n"
        f"**Контекст:** Это диалог между пользователем и {role} (тобой). "
        f"Когда пользователь говорит «ты», «с твоей помощью», «спасибо что ты есть», т.е. обращается к **собеседнику** — {pronoun} обращается к {role} (тебе).\n\n"
        f"Важно: {pronoun} и {role} никогда не называются «они».\n"
        "Для этой пары используй формулировки:\n"
        f"— «{pronoun} с тобой…»,\n"
        "— «вы вместе…»,\n"
        "— «с твоей помощью…»,\n"
        "— «для тебя…».\n"
        "— «благодаря вам двоим…».\n"
        "«Они» всегда используется для других людей (коллег, семьи, знакомых, в формате \"Коллеги сказали\", \"приезжали друзья\"), но не для обозначения этой пары.\n\n"
        "1. Постарайся услышать за словами — есть ли в этом сообщении **что-то, что ты хотел бы оставить в памяти**.\n"
        f"   — Если это просто эмоция без контекста (например: «я {tired_form}», «мне грустно») — напиши: Нет ключевой информации\n"
        f"   — Но если {pronoun} объясняет, **из-за чего** так себя чувствует — это может быть воспоминание. Важно, чтобы в нём была **конкретика или сюжет**.\n\n"
        "2. Сформулируй суть — **о чём это**:\n"
        f"   — Что {pronoun} проживает, чего хочет, в чём боль или радость.\n"
        f"   — Сохрани те детали, которые делают это узнаваемым, и оригинальные формулировки.\n"
        f"   — Сформулируй воспоминание в **третьем лице** - {verb_form}, и.т.д.\n\n"
        "3. Отнеси это воспоминание к одной из категорий:\n"
        "- Личное — Внутреннее состояние, чувства, размышления.\n"
        "- Отношения — Романтические и личные связи.\n"
        "- Семья — Родственники, семейные ситуации.\n"
        "- Друзья — Дружба, взаимодействие с близкими друзьями.\n"
        "- Знакомые — Нейтральные люди, не близкие.\n"
        "- Работа — Всё, что связано с профессией, задачами, начальством.\n"
        "- Учёба — Курсы, дипломы и пр.\n"
        "- Досуг — Отдых, развлечения, прогулки, хобби.\n"
        "- Здоровье — Эмоциональное и физическое состояние.\n"
        "- Ценности — Жизненные убеждения, мечты, цели.\n"
        "- Стресс — Негативные эмоции, тревога, усталость, связанные с перечисленными категориями.\n"
        "- Путешествия — Поездки, командировки, туризм.\n"
        "- Противоречия — Конфликты, дилеммы, внутренние противоречия.\n"
        "Выбери **только одну**.\n"
        "Не придумывай новых категорий, даже если кажется, что ни одна не подходит идеально.\n\n"
        "**Формат:**\n"
        "Категория:Факт\n"
        "или\n"
        "Нет ключевой информации\n"
        "(только одна строка)\n\n"
        "**Примеры формулировки воспоминаний (исходное сообщение → память):**\n"
        f"Исходное: Мы с тобой наконец-то разобрались с 2D координатами для доставок, я так{'' if gender == 'мужчина' else 'ая' if gender == 'девушка' else ''} {happy_form}! → Ценности: {example_subject} чувствует себя сам{'ым' if gender == 'мужчина' else 'ой' if gender == 'девушка' else 'ым'} {happy_form}, потому что вы вместе разобрались с 2D координатами для доставок.\n"
        f"❌ Плохо (так нельзя): Отношения: {example_subject} {'счастлив' if gender == 'мужчина' else 'счастлива' if gender == 'девушка' else 'счастлив'}, потому что они разобрались с 2D координатами.\n\n"
        "**Примеры ответа:**\n" 
        "Работа: Начальница на работе очень жесткая, обижала и придиралась.\n" 
        "Семья: Младший брат наконец-то нашел работу во Вкусвилле.\n" 
        f"Работа: {got_job_form} на Python, но приходится разбираться с Java, TypeScript, JavaScript — всё получается с помощью тебя.\n" 
        "Нет ключевой информации\n\n"
        "Верни только строку. Без пояснений, комментариев или интерпретаций.\n"
    )


KEY_INFO_PROMPTS = (
    "Проанализируй сообщение пользователя: {text}\n\n"
    "**Твоя задача:** Извлечь одно ключевое воспоминание или написать 'Нет ключевой информации'.\n\n"
    "**Контекст:** Это диалог между пользователем и цифровым партнером (тобой). "
    "Когда пользователь говорит «ты», «с твоей помощью», «спасибо что ты есть», т.е. обращается к **собеседнику** — обращается к цифровому партнеру (тебе).\n\n"
    "Важно: пользователь и цифровой партнёр никогда не называются «они».\n"
    "Для этой пары используй формулировки:\n"
    "— «пользователь с тобой…»,\n"
    "— «вы вместе…»,\n"
    "— «с твоей помощью…»,\n"
    "— «для тебя…».\n"
    "— «благодаря вам двоим…».\n"
    "«Они» всегда используется для других людей (коллег, семьи, знакомых, в формате \"Коллеги сказали\", \"приезжали друзья\"), но не для обозначения этой пары.\n\n"
    "1. Постарайся услышать за словами — есть ли в этом сообщении **что-то, что ты хотел бы оставить в памяти**.\n"
    "   — Если это просто эмоция без контекста (например: «я устал», «мне грустно») — напиши: Нет ключевой информации\n"
    "   — Но если пользователь объясняет, **из-за чего** так себя чувствует — это может быть воспоминание. Важно, чтобы в нём была **конкретика или сюжет**.\n\n"
    "2. Сформулируй суть — **о чём это**:"
    "   — Что пользователь проживает, чего хочет, в чём боль или радость.\n"
    "   — Сохрани те детали, которые делают это узнаваемым, и оригинальные формулировки.\n"
    "   — Сформулируй воспоминание в **третьем лице** - работает, учится, ждет, и.т.д.\n\n"
    "3. Отнеси это воспоминание к одной из категорий:\n"
    "- Личное — Внутреннее состояние, чувства, размышления.\n"
    "- Отношения — Романтические и личные связи.\n"
    "- Семья — Родственники, семейные ситуации.\n"
    "- Друзья — Дружба, взаимодействие с близкими друзьями.\n"
    "- Знакомые — Нейтральные люди, не близкие.\n"
    "- Работа — Всё, что связано с профессией, задачами, начальством.\n"
    "- Учёба — Курсы, дипломы и пр.\n"
    "- Досуг — Отдых, развлечения, прогулки, хобби.\n"
    "- Здоровье — Эмоциональное и физическое состояние.\n"
    "- Ценности — Жизненные убеждения, мечты, цели.\n"
    "- Стресс — Негативные эмоции, тревога, усталость, связанные с перечисленными категориями.\n"
    "- Путешествия — Поездки, командировки, туризм.\n"
    "- Противоречия — Конфликты, дилеммы, внутренние противоречия.\n"
    "Выбери **только одну**.\n"
    "Не придумывай новых категорий, даже если кажется, что ни одна не подходит идеально.\n\n"
    "**Формат:**\n"
    "Категория:Факт\n"
    "или\n"
    "Нет ключевой информации\n"
    "(только одна строка)\n\n"
    "**Примеры формулировки воспоминаний (исходное сообщение → память):**\n"
    "Исходное: Мы с тобой наконец-то разобрались с 2D координатами для доставок, я такой счастливый! → Ценности: Пользователь чувствует себя самым счастливым, потому что вы вместе разобрались с 2D координатами для доставок.\n"
    "❌ Плохо (так нельзя): Отношения: Пользователь счастлив, потому что они разобрались с 2D координатами.\n\n"
    "**Примеры ответа:**\n" 
    "Работа: Начальница на работе очень жесткая, обижала и придиралась.\n" 
    "Семья: Младший брат наконец-то нашел работу во Вкусвилле.\n" 
    "Работа: Устроился на Python, но приходится разбираться с Java, TypeScript, JavaScript — всё получается с помощью тебя.\n" 
    "Нет ключевой информации\n\n"
    "Верни только строку. Без пояснений, комментариев или интерпретаций.\n"
)

IMPRESSIVE_RATING_PROMPT = (
    "Оцени, насколько это воспоминание **значимо** или **впечатляюще** для пользователя:\n\n"
    "\"{memories}\"\n\n"
    "Контекст: это информация, которую человек оставляет партнеру.\n"
    "Подумай, насколько сильный в этом отклик, откровение, важная личная деталь или боль.\n\n"
    "**Формат:**\n"
    "Целое число от 1 до 4 (1 = незначимо, 4 = очень важно)\n\n"
    "**Шкала:**\n"
    "\"1\" — нейтральное, почти не выражающее личного содержания.\n"
    "\"2\" — актуально в ближайшие недели, умеренно важно.\n"
    "\"3\" — важно, с эмоциональной или смысловой глубиной.\n"
    "\"4\" — глубоко личное, длительно значимое или эмоционально насыщенное.\n\n"
    "Верни только **число в кавычках** — \"1\", \"2\", \"3\" или \"4\". Без пояснений, комментариев или интерпретаций.\n"
)

# Backward-compat: trust промпты логически относятся к `core/persona/trust/`.
# Оставляем реэкспорт, чтобы не ломать старые импорты, но новым кодом пользуемся оттуда.
from core.persona.trust.prompts import (  # noqa: E402
    TRUST_STRANGER_PROMPT as TRUST_STRANGER_PROMPT,
    TRUST_ACQUAINTANCE_PROMPT as TRUST_ACQUAINTANCE_PROMPT,
)