# –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ Victor AI

## üéØ –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

* **Anchor / focus** ‚Üí —ç—Ç–æ —Ç–æ, —á—Ç–æ **–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–∞–µ—Ç** (—Å–º—ã—Å–ª–æ–≤—ã–µ –æ–ø–æ—Ä—ã –≤ —Ç–µ–∫—Å—Ç–µ).
* **Reactions (`hug`, `presence`, `resonance` –∏ —Ç.–ø.)** ‚Üí —ç—Ç–æ —Ç–æ, —á—Ç–æ **Victor –¥–µ–ª–∞–µ—Ç** –≤ –æ—Ç–≤–µ—Ç.
* **Emoji** ‚Üí —ç—Ç–æ **—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** —Ç–æ–≥–æ, *–∫–∞–∫ Victor —Å–ø—Ä–∞–≤–∏–ª—Å—è* –∏ *–∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å —ç—Ç–∏–º*.
* **Intensity** ‚Üí –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è Victor'–∞ –æ—Ç 0 –¥–æ 12, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∞—è —Å–∫–æ–ª—å–∫–æ –æ–Ω –≤–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (self-disclosure).

---

## üîÑ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### 1. –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —ç–º–æ—Ü–∏–π Victor'–∞

#### 1.1 –≠–º–æ–¥–∑–∏ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–º–∞–π–ª—ã** –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ emoji:
  - `)` ‚Üí üôÇ (–ª–µ–≥–∫–∞—è —Ä–∞–¥–æ—Å—Ç—å)
  - `))`, `)))` ‚Üí üòä (—Ä–∞–¥–æ—Å—Ç—å)
  - `))))` –∏ –±–æ–ª–µ–µ ‚Üí üòÇ (—Å–∏–ª—å–Ω–∞—è —Ä–∞–¥–æ—Å—Ç—å)
  - `(`, `((`, `(((` ‚Üí üòî (–≥—Ä—É—Å—Ç—å)
  - `((((` –∏ –±–æ–ª–µ–µ ‚Üí üò• (—Å–∏–ª—å–Ω–∞—è –≥—Ä—É—Å—Ç—å)

- **Emoji –º–∞–ø–ø–∏–Ω–≥** —á–µ—Ä–µ–∑ `EMOJI_TO_EMOTIONS`:
  ```python
  "‚ù§Ô∏è" ‚Üí [(TENDERNESS, 1.0), (JOY, 0.8), (ADMIRATION, 0.5)]
  "üòç" ‚Üí [(ADMIRATION, 1.0), (TENDERNESS, 0.9), (JOY, 0.8)]
  ```

#### 1.2 –ê–∫—Ç–∏–≤–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∏ —Ä–µ–∞–∫—Ü–∏–π (Reaction Counters)
–ò–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ `ReactionFragments` (start, core, question, end):
- `"–æ–±–Ω–∏–º–∏ —Å–ª–æ–≤–∞–º–∏"` ‚Üí `hug_count` ‚Üí [TENDERNESS]
- `"–¥–∞–π —è–∫–æ—Ä—å"` ‚Üí `anchor_thought_count` ‚Üí [DETERMINATION, CURIOSITY]
- `"—Ç—ã –ø–æ–∑–≤–æ–ª—è–µ—à—å —ç—Ç–æ–º—É —á—É–≤—Å—Ç–≤—É –ø—Ä–æ–∑–≤—É—á–∞—Ç—å —à–∏—Ä–µ"` ‚Üí `resonance_count` ‚Üí [TENDERNESS]

–ú–∞–ø–ø–∏–Ω–≥ —á–µ—Ä–µ–∑ `_counter_to_moods`:
```python
"hug": [AssistantMood.TENDERNESS],
"clarify": [AssistantMood.CURIOSITY, AssistantMood.INSPIRATION],
"resonance": [AssistantMood.TENDERNESS],
```

#### 1.3 –ù–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ —Å—á–µ—Ç—á–∏–∫–∏ (Session Context)
–ö–æ–≥–¥–∞ —Å—á–µ—Ç—á–∏–∫ ‚â• 3, –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –µ–≥–æ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ.

#### 1.4 –í–µ—Å–∞ —ç–º–æ—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
–ò–∑ `session_context.weights` (joy, sadness, anger –∏ —Ç.–¥.)

#### 1.5 –Ø–∫–æ—Ä—è –∏ —Ñ–æ–∫—É—Å—ã
- `is_strong_anchor` ‚Üí +1.5 –∫ DETERMINATION
- `is_strong_focus` ‚Üí +1.0 –∫ CURIOSITY

---

## ‚ö° –†–∞—Å—á–µ—Ç Intensity (–≠–Ω–µ—Ä–≥–∏—è Victor'–∞)

### –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ 0-12

```python
new_intensity = prev_intensity + CATEGORY_ENERGY_COST + COUNTERS_ENERGY_COST
```

#### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (CATEGORY_ENERGY_COST):
```python
PHATIC    = 0.5   # "–ü—Ä–∏–≤–µ—Ç", "–ö–∞–∫ –¥–µ–ª–∞?"
FACT      = 1.0   # –§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
ACTION    = 1.0   # –î–µ–π—Å—Ç–≤–∏—è
OPINION   = 1.5   # –ú–Ω–µ–Ω–∏—è
DREAM     = 2.0   # –ú–µ—á—Ç—ã
FEELING   = 2.0   # –ß—É–≤—Å—Ç–≤–∞
FEAR      = 3.0   # –°—Ç—Ä–∞—Ö–∏
NEED      = 3.0   # –ü–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏
```

#### –°—á–µ—Ç—á–∏–∫–∏ —Ä–µ–∞–∫—Ü–∏–π (COUNTERS_ENERGY_COST):
```python
hug_count            = 3   # –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –æ–±–Ω–∏–º–∞–Ω–∏–µ
observe_count        = 3   # –ì–ª—É–±–æ–∫–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ
support_count        = 3   # –ü–æ–¥–¥–µ—Ä–∂–∫–∞
resonance_count      = 4   # –†–µ–∑–æ–Ω–∞–Ω—Å (—Å–∞–º–∞—è –∑–∞—Ç—Ä–∞—Ç–Ω–∞—è)
anchor_thought_count = 2   # –Ø–∫–æ—Ä–Ω—ã–µ –º—ã—Å–ª–∏
clarify_count        = 2   # –ü—Ä–æ—è—Å–Ω–µ–Ω–∏–µ
presence_count       = 1   # –ü—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ
```

### –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ (Intensity > 12)

–ö–æ–≥–¥–∞ intensity –ø—Ä–µ–≤—ã—à–∞–µ—Ç 12 ‚Üí **–ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –¥—Ä—É–≥—É—é —ç–º–æ—Ü–∏—é**:

1. –ù–∞—Ö–æ–¥–∏—Ç—Å—è –±–ª–∏–∂–∞–π—à–∞—è —ç–º–æ—Ü–∏—è –ø–æ –µ–≤–∫–ª–∏–¥–æ–≤—É —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é –≤ `_emotion_map`
2. Victor –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ —ç—Ç—É —ç–º–æ—Ü–∏—é
3. `new_intensity = intensity - 12.0` (–æ—Å—Ç–∞—Ç–æ–∫ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è)

**Emotion Map** (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —ç–º–æ—Ü–∏–π):
```python
JOY           = (0.9, 0.8)  # –í—ã—Å–æ–∫–∞—è –≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å, –≤—ã—Å–æ–∫–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è
SADNESS       = (0.2, 0.2)  # –ù–∏–∑–∫–∞—è –≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å, –Ω–∏–∑–∫–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è
TENDERNESS    = (0.7, 0.6)  # –°—Ä–µ–¥–Ω–µ-–≤—ã—Å–æ–∫–∞—è –≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å, —Å—Ä–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è
CURIOSITY     = (0.8, 0.5)  # –í—ã—Å–æ–∫–∞—è –≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å, —Å—Ä–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è
SERENITY      = (0.6, 0.4)  # –°—Ä–µ–¥–Ω—è—è –≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å, —Å—Ä–µ–¥–Ω–µ-–Ω–∏–∑–∫–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è
DETERMINATION = (0.8, 0.7)  # –í—ã—Å–æ–∫–∞—è –≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å, –≤—ã—Å–æ–∫–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è
```

---

## üé≠ –í—ã–±–æ—Ä –¥–æ–º–∏–Ω–∏—Ä—É—é—â–µ–π —ç–º–æ—Ü–∏–∏

–í—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —ç–º–æ—Ü–∏–π –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è –≤ `mood_scores`:

```python
mood_scores = defaultdict(float)

# –≠–º–æ–¥–∑–∏ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è: –≤–µ—Å –Ω–∞–ø—Ä—è–º—É—é
for mood, weight in emoji_moods.items():
    mood_scores[mood] += weight

# –ê–∫—Ç–∏–≤–Ω—ã–µ counters: +1.5
for counter in active_counters:
    for mood in _counter_to_moods[counter]:
        mood_scores[mood] += 1.5

# –ù–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ counters (‚â•3): +1.0
for counter, count in session_counters.items():
    if count >= 3:
        for mood in _counter_to_moods[counter]:
            mood_scores[mood] += 1.0

# –í–µ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
for emotion_name, weight in user_weights.items():
    mood_scores[emotion_name] += weight

# –Ø–∫–æ—Ä—è –∏ —Ñ–æ–∫—É—Å—ã
if is_strong_anchor:
    mood_scores[DETERMINATION] += 1.5
if is_strong_focus:
    mood_scores[CURIOSITY] += 1.0

# –í—ã–±–æ—Ä –¥–æ–º–∏–Ω–∏—Ä—É—é—â–µ–π
dominant_mood = max(mood_scores.items(), key=lambda x: x[1])[0]
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å emoji
```
User: "–ü—Ä–∏–≤–µ—Ç! üòä"
```

1. **–ü–∞—Ä—Å–∏–Ω–≥**: emoji = ["üòä"]
2. **–ú–∞–ø–ø–∏–Ω–≥**: 
   - TENDERNESS: 1.0
   - JOY: 0.7
   - RELIEF: 0.4
3. **–î–æ–º–∏–Ω–∏—Ä—É—é—â–∞—è**: TENDERNESS (1.0)
4. **Intensity**: 
   - prev: 2.0
   - category (PHATIC): +0.5
   - new: 2.5
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: mood=TENDERNESS, intensity=2.5

### –ü—Ä–∏–º–µ—Ä 2: –ì–ª—É–±–æ–∫–∏–π —Ä–∞–∑–≥–æ–≤–æ—Ä —Å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ–º
```
User: "–ú–Ω–µ —Å—Ç—Ä–∞—à–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è –ª—é–¥—è–º üò•"
+ Victor –∏—Å–ø–æ–ª—å–∑—É–µ—Ç: "–æ–±–Ω–∏–º–∏ —Å–ª–æ–≤–∞–º–∏" (hug), "—Ç—ã –ø–æ–∑–≤–æ–ª—è–µ—à—å –∑–≤—É—á–∞—Ç—å —à–∏—Ä–µ" (resonance)
```

1. **Emoji**: üò• ‚Üí SADNESS(0.9), FATIGUE(0.6)
2. **Counters**: 
   - hug ‚Üí TENDERNESS (+1.5)
   - resonance ‚Üí TENDERNESS (+1.5)
3. **–î–æ–º–∏–Ω–∏—Ä—É—é—â–∞—è**: TENDERNESS (3.0)
4. **Intensity**:
   - prev: 10.0
   - category (FEAR): +3.0
   - hug_count: +3
   - resonance_count: +4
   - total: 10 + 3 + 3 + 4 = 20.0
5. **–ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ**: 20.0 > 12
   - –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –±–ª–∏–∂–∞–π—à—É—é —ç–º–æ—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, SERENITY)
   - new_intensity: 20.0 - 12.0 = 8.0
6. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: mood=SERENITY, intensity=8.0

### –ü—Ä–∏–º–µ—Ä 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ emoji —á–µ—Ä–µ–∑ /update_emoji
```
User —Å—Ç–∞–≤–∏—Ç ‚ù§Ô∏è –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ Victor'–∞
```

1. **Emoji**: ‚ù§Ô∏è ‚Üí TENDERNESS(1.0), JOY(0.8), ADMIRATION(0.5)
2. **–î–æ–º–∏–Ω–∏—Ä—É—é—â–∞—è**: TENDERNESS (1.0)
3. **Intensity**:
   - prev: 5.0
   - weight √ó 0.5: 1.0 √ó 0.5 = 0.5
   - new: 5.5
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: mood=TENDERNESS, intensity=5.5
5. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ** –≤ session_context

---

## üîÑ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### –í session_context —Ö—Ä–∞–Ω–∏—Ç—Å—è:
```python
victor_mood_history: List[str]        # ["TENDERNESS", "JOY", "CURIOSITY"]
victor_intensity_history: List[float] # [2.5, 5.0, 8.5]
```

### –ü—Ä–∏ —Å–±—Ä–æ—Å–µ —Å–µ—Å—Å–∏–∏ (reset_after_save):
- –û—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è **–ø–æ—Å–ª–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ** –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–µ–µ–º—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏

### –ú–µ—Ç–æ–¥—ã –¥–æ—Å—Ç—É–ø–∞:
```python
session_context.get_last_victor_mood()       # ‚Üí "TENDERNESS"
session_context.get_last_victor_intensity()  # ‚Üí 8.5
```

---

## üìÅ –§–∞–π–ª—ã —Å–∏—Å—Ç–µ–º—ã

- `engine.py` - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ (ViktorEmotionEvaluator)
- `emotional_map.py` - –∫–∞—Ä—Ç—ã –º–∞–ø–ø–∏–Ω–≥–∞ (EMOJI_TO_EMOTIONS, ENERGY_COST)
- `session_context_schema.py` - —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –º–µ—Ç–æ–¥—ã –¥–æ—Å—Ç—É–ø–∞
- `communication.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π flow
- `chat.py` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ /update_emoji —ç–Ω–¥–ø–æ–∏–Ω—Ç

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **–ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: intensity –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
2. **–ü–µ—Ä–µ—Ö–æ–¥—ã**: –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ Victor –º–µ–Ω—è–µ—Ç —ç–º–æ—Ü–∏—é –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –æ–±—Ä–∞–∑–æ–º
3. **–ú–Ω–æ–≥–æ–∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤–æ—Å—Ç—å**: —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è emoji, counters, —è–∫–æ—Ä—è, —Ñ–æ–∫—É—Å—ã
4. **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
5. **–†–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –æ—Ü–µ–Ω–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (emoji)
